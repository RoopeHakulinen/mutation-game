<mat-slide-toggle
  [checked]="toggles.showInstructions"
  (change)="toggles.showInstructions = !toggles.showInstructions">
  Show instructions
</mat-slide-toggle>
<div *ngIf="toggles.showInstructions" class="instructions">
  <p style="text-align: left; margin-left: 20px;">Follow these 6 instructions & play the Mutation Game!</p>
  <ul>
    <li><b>Craft a Description:</b> toggle the edit mode, pick a meaningful string of 5 to 8 components that describe in
      one sentence the object to mutate, and write these in column 1. A component can contain more than one word when
      appropriate, e.g. ”for a short ride”, although one word is best. The empty button clears the grid on screen, and
      the restore button shows our default example (the London taxi industry)
    </li>
    <li><b>Generate Alternative Components:</b> generate a grid of alternative components, with 2 to 4 alternatives for
      each of the components in the initial description sentence. First add columns, write 5 or 6 alternative components
      for each row, shrink back to your preferred 2 to 4, and then remove unnecessary columns when you’re done. A square
      grid is best (i.e. without empty boxes). Toggle back the edit mode to secure your chosen grid.
    </li>
    <li><b>Pick Mutations & Generate Ideas:</b> a mutation is a sentence arrived at by selecting 1 component per row.
      Each mutation gets a unique number, made by listing the column numbers of the components it contains (nb: the
      mutation number of the initial description is a long string of “1”). Go through c. 50 mutations, spending 10 to 20
      seconds per mutation, to trigger creative ideas. You can have more than one idea per mutation, and many mutations
      can give rise to the same idea. Move on to a next mutation if drawing blank at any time.
    </li>
    <li><b>Choose Manual or Automatic mode:</b> in the manual mode, you have to construct each mutation yourself, by
      intentionally selecting 1 component per row by hand. The automatic mode is more like a Las Vegas slot machine,
      showing you a different randomly-generated mutation every time you press the random button. Automatic mode is a
      lot a fun, and sometimes yield revolutionary ideas. Manual mode is smarter, and always trigger great evolutionary
      ideas.
    </li>
    <li><b>Save and Review:</b> press the save button every time you see a mutation you like, and that mutation’s
      details (words + number) will be stored in a CSV file. Press the review button to download the file, with all your
      saved mutations. A new CSV file is restarted every time you edit a new grid.
    </li>
    <li><b>Package your Best Ideas:</b> summarize your best ideas in 2 to 4 words each, to convey them crisply and
      clearly. Add the unique mutation number of the mutation that triggered the idea for future recollection.
    </li>
  </ul>
</div>

<div class="grid-container">
  <div class="grid" fxLayout="row">
    <div class="column" *ngFor="let column of grid.columns; let columnIndex = index" fxLayout="column">
      <div fxFlex class="header">{{columnIndex + 1}}</div>
      <div
        class="word"
        *ngFor="let word of column; let rowIndex = index"
        (click)="!toggles.isEditing && word.word.length && selectWord(columnIndex, rowIndex)"
        [class.selected]="!toggles.isEditing && word.selected">
        <input
          matInput
          placeholder="Word"
          size="8"
          [(ngModel)]="column[rowIndex].word"
          *ngIf="toggles.isEditing" />
        <span *ngIf="!toggles.isEditing">
          {{word.word.length ? word.word : '&nbsp;'}}
        </span>
      </div>
    </div>
  </div>
  <div class="generate-button-container" *ngIf="toggles.isAutomaticModeEnabled">
    <button (click)="pickRandom()" mat-flat-button style="position: absolute;margin-left: 20px;">Random</button>
  </div>
</div>

<div *ngIf="toggles.isEditing">
  Combinations: <b>{{getNumberOfCombinations()}}</b>
</div>

<div
  fxLayout="row wrap"
  fxLayout.xs="column"
  fxLayoutAlign="center"
  fxLayoutGap="10px"
  style="margin: 10px;">
  <button mat-flat-button (click)="addColumn()" *ngIf="toggles.isEditing">
    Add column
  </button>
  <button
    mat-flat-button
    (click)="deleteColumn()"
    [disabled]="grid.columns.length === 1"
    *ngIf="toggles.isEditing">
    Delete column
  </button>
  <button mat-flat-button (click)="addRow()" *ngIf="toggles.isEditing">
    Add row
  </button>
  <button
    mat-flat-button
    (click)="deleteRow()"
    [disabled]="grid.columns[0].length === 1"
    *ngIf="toggles.isEditing">
    Delete row
  </button>
  <button mat-flat-button color="warn" (click)="makeEmpty()" *ngIf="toggles.isEditing">
    Empty
  </button>
  <button mat-flat-button color="warn" (click)="reset()" *ngIf="toggles.isEditing">
    Restore
  </button>
</div>

<mat-slide-toggle
  style="margin-top: 16px;"
  [checked]="toggles.isEditing"
  (change)="toggleEdit()">
  Edit mode
</mat-slide-toggle>
<br />
<mat-slide-toggle
  [checked]="toggles.isAutomaticModeEnabled"
  (change)="toggles.isAutomaticModeEnabled = !toggles.isAutomaticModeEnabled"
  *ngIf="!toggles.isEditing">
  Random mode
</mat-slide-toggle>

<div class="current-mutation" *ngIf="!toggles.isEditing">
  Current mutation: <br />
  <b>{{getSelectedWords().join(' | ')}}</b>
  <br />
  <b>{{getSelectedIndexes().join('')}}</b>
</div>

<div class="saved-combinations-container">
  <button mat-flat-button (click)="saveCombination()" *ngIf="!toggles.isEditing" style="margin-right: 10px;">
    Save
  </button>
  <button mat-flat-button color="accent" (click)="exportAsCsv()" *ngIf="!toggles.isEditing">
    Review
  </button>
  <div class="combinations">
    <div class="combination" *ngFor="let row of savedCombinations">
      {{row.combinationKey.join('')}} - {{row.words.join(' | ')}}
    </div>
  </div>
</div>
